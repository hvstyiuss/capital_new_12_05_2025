@extends('layouts.app')

@section('title', 'Modifier l\'Exploitant - Capital')

@section('content')
<div class="container mx-auto px-4 py-8">
    <!-- Header Section -->
    <div class="mb-8">
        <div class="flex items-center gap-4 mb-6">
            <div class="w-16 h-16 bg-gradient-to-br from-teal-500 to-cyan-600 rounded-2xl flex items-center justify-center">
                <i class="fas fa-user-edit text-white text-2xl"></i>
            </div>
            <div>
                <h1 class="text-4xl font-bold bg-gradient-to-r from-teal-600 to-cyan-600 bg-clip-text text-transparent">
                    Modifier l'Exploitant
                </h1>
                <p class="text-gray-600 text-lg mt-2">Modifiez les informations de l'exploitant "{{ $exploitant->nom_complet ?? $exploitant->raison_sociale }}"</p>
            </div>
        </div>
    </div>

    <!-- Alert Messages -->
    @if(session('success'))
        <div class="bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-500 text-green-700 p-6 rounded-xl mb-6 shadow-lg">
            <div class="flex items-center gap-3">
                <i class="fas fa-check-circle text-2xl"></i>
                <div>
                    <h3 class="font-semibold text-lg">Succès!</h3>
                    <p>{{ session('success') }}</p>
                </div>
            </div>
        </div>
    @endif

    @if(session('error'))
        <div class="bg-gradient-to-r from-red-50 to-pink-50 border-l-4 border-red-500 text-red-700 p-6 rounded-xl mb-6 shadow-lg">
            <div class="flex items-center gap-3">
                <i class="fas fa-exclamation-triangle text-2xl"></i>
                <div>
                    <h3 class="font-semibold text-lg">Erreur!</h3>
                    <p>{{ session('error') }}</p>
                </div>
            </div>
        </div>
    @endif

    <!-- Edit Form -->
    <div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl p-8 border border-white/20">
        <div class="flex items-center gap-4 mb-6">
            <div class="w-12 h-12 bg-gradient-to-br from-teal-500 to-cyan-600 rounded-xl flex items-center justify-center">
                <i class="fas fa-edit text-white text-xl"></i>
            </div>
            <div>
                <h2 class="text-2xl font-bold text-gray-900">Formulaire de modification</h2>
                <p class="text-gray-600">Modifiez les informations de l'exploitant forestier</p>
            </div>
        </div>

        <form action="{{ route('exploitants.update', $exploitant) }}" method="POST" class="space-y-8" id="exploitantForm" novalidate data-server-validation>
            @csrf
            @method('PUT')

            <!-- Section 1: Informations de Base -->
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-200">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-info-circle text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-blue-900">Informations de Base</h3>
                        <p class="text-blue-700 text-sm">Informations principales de l'exploitant</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Numéro -->
                    <div class="form-group">
                        <label for="numero" class="block text-sm font-semibold text-gray-700 mb-2">
                            Numéro
                        </label>
                        <input 
                            type="text" 
                            name="numero" 
                            id="numero" 
                            value="{{ old('numero', $exploitant->numero) }}"
                            class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 hover:border-gray-400"
                            placeholder="Ex: EXP001"
                        >
                        @error('numero')
                            <div class="text-red-500 text-sm mt-1 flex items-center gap-2">
                                <i class="fas fa-exclamation-circle"></i>
                                {{ $message }}
                            </div>
                        @enderror
                    </div>

                    <!-- N° CIN -->
                    <div class="form-group">
                        <label for="n_cin" class="block text-sm font-semibold text-gray-700 mb-2">
                            Numéro CIN <span class="text-red-500">*</span>
                        </label>
                        <input 
                            type="text" 
                            name="n_cin" 
                            id="n_cin" 
                            value="{{ old('n_cin', $exploitant->n_cin) }}"
                            class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 hover:border-gray-400"
                            placeholder="Ex: AB123456"
                            pattern="[A-Z]{2}[0-9]{6}"
                            required
                        >
                        @error('n_cin')
                            <div class="text-red-500 text-sm mt-1 flex items-center gap-2">
                                <i class="fas fa-exclamation-circle"></i>
                                {{ $message }}
                            </div>
                        @enderror
                    </div>

                    <!-- Localisation -->
                    <div class="form-group">
                        <label for="localisation_id" class="block text-sm font-semibold text-gray-700 mb-2">
                        DRANEF <span class="text-red-500">*</span>
                        </label>
                        <select 
                            name="localisation_id" 
                            id="localisation_id"
                            class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 hover:border-gray-400"
                            required
                        >
                            <option value="">Sélectionnez une DRANEF</option>
                            @foreach($localisations as $localisation)
                                <option value="{{ $localisation->id }}" {{ old('localisation_id', $exploitant->localisation_id) == $localisation->id ? 'selected' : '' }}>
                                   {{ $localisation->DRANEF }}
                                </option>
                            @endforeach
                        </select>
                        @error('localisation_id')
                            <div class="text-red-500 text-sm mt-1 flex items-center gap-2">
                                <i class="fas fa-exclamation-circle"></i>
                                {{ $message }}
                            </div>
                        @enderror
                    </div>

                    <!-- Nom Complet -->
                    <div class="form-group">
                        <label for="nom_complet" class="block text-sm font-semibold text-gray-700 mb-2">
                            Nom Complet
                        </label>
                        <input 
                            type="text" 
                            name="nom_complet" 
                            id="nom_complet" 
                            value="{{ old('nom_complet', $exploitant->nom_complet) }}"
                            class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 hover:border-gray-400"
                            placeholder="Nom complet de l'exploitant"
                        >
                        @error('nom_complet')
                            <div class="text-red-500 text-sm mt-1 flex items-center gap-2">
                                <i class="fas fa-exclamation-circle"></i>
                                {{ $message }}
                            </div>
                        @enderror
                    </div>

                    <!-- Catégorie -->
                    <div class="form-group">
                        <label for="categorie" class="block text-sm font-semibold text-gray-700 mb-2">
                            Catégorie <span class="text-red-500">*</span>
                        </label>
                        <select 
                            name="categorie" 
                            id="categorie"
                            class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 hover:border-gray-400"
                            required
                        >
                            <option value="">Sélectionnez une catégorie</option>
                            <option value="societe" {{ old('categorie', $exploitant->categorie) == 'societe' ? 'selected' : '' }}>Société</option>
                            <option value="personne_physique" {{ old('categorie', $exploitant->categorie) == 'personne_physique' ? 'selected' : '' }}>Personne Physique</option>
                        </select>
                        @error('categorie')
                            <div class="text-red-500 text-sm mt-1 flex items-center gap-2">
                                <i class="fas fa-exclamation-circle"></i>
                                {{ $message }}
                            </div>
                        @enderror
                    </div>

                    <!-- Raison Sociale -->
                    <div class="form-group">
                        <label for="raison_sociale" class="block text-sm font-semibold text-gray-700 mb-2">
                            Raison Sociale
                        </label>
                        <input 
                            type="text" 
                            name="raison_sociale" 
                            id="raison_sociale" 
                            value="{{ old('raison_sociale', $exploitant->raison_sociale) }}"
                            class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 hover:border-gray-400"
                            placeholder="Raison sociale (si société)"
                        >
                        @error('raison_sociale')
                            <div class="text-red-500 text-sm mt-1 flex items-center gap-2">
                                <i class="fas fa-exclamation-circle"></i>
                                {{ $message }}
                            </div>
                        @enderror
                    </div>
                </div>
            </div>

            <!-- Section 2: Activité et Adjudication -->
            <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-6 border border-green-200">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-briefcase text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-green-900">Activité et Adjudication</h3>
                        <p class="text-green-700 text-sm">Informations sur l'activité forestière</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Activité -->
                    <div class="form-group">
                        <label for="activite" class="block text-sm font-semibold text-gray-700 mb-2">
                            Activité <span class="text-red-500">*</span>
                        </label>
                        <select 
                            name="activite" 
                            id="activite"
                            class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 hover:border-gray-400"
                            required
                        >
                            <option value="">Sélectionnez une activité</option>
                            <option value="BI" {{ old('activite', $exploitant->activite) == 'BI' ? 'selected' : '' }}>BI</option>
                            <option value="BP" {{ old('activite', $exploitant->activite) == 'BP' ? 'selected' : '' }}>BP</option>
                            <option value="PAM" {{ old('activite', $exploitant->activite) == 'PAM' ? 'selected' : '' }}>PAM</option>
                        </select>
                        @error('activite')
                            <div class="text-red-500 text-sm mt-1 flex items-center gap-2">
                                <i class="fas fa-exclamation-circle"></i>
                                {{ $message }}
                            </div>
                        @enderror
                    </div>
                </div>

                <!-- Adresse -->
                <div class="form-group">
                    <label for="adresse" class="block text-sm font-semibold text-gray-700 mb-2">
                        Adresse <span class="text-red-500">*</span>
                    </label>
                    <textarea 
                        name="adresse" 
                        id="adresse" 
                        rows="3"
                        class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 hover:border-gray-400"
                        placeholder="Adresse complète de l'exploitant"
                        required
                    >{{ old('adresse', $exploitant->adresse) }}</textarea>
                    @error('adresse')
                        <div class="text-red-500 text-sm mt-1 flex items-center gap-2">
                            <i class="fas fa-exclamation-circle"></i>
                            {{ $message }}
                        </div>
                    @enderror
                </div>
            </div>

            <!-- Section 3: Qualification RC -->
            <div class="bg-gradient-to-r from-purple-50 to-violet-50 rounded-2xl p-6 border border-purple-200">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-violet-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-certificate text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-purple-900">Qualification RC</h3>
                        <p class="text-purple-700 text-sm">Informations sur la qualification RC</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Qualification RC -->
                    <div class="form-group">
                        <label for="qualification_rc" class="block text-sm font-semibold text-gray-700 mb-2">
                            Qualification RC
                        </label>
                        <input 
                            type="text" 
                            name="qualification_rc" 
                            id="qualification_rc" 
                            value="{{ old('qualification_rc', $exploitant->qualification_rc) }}"
                            class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 hover:border-gray-400"
                            placeholder="Qualification RC"
                        >
                        @error('qualification_rc')
                            <div class="text-red-500 text-sm mt-1 flex items-center gap-2">
                                <i class="fas fa-exclamation-circle"></i>
                                {{ $message }}
                            </div>
                        @enderror
                    </div>

                    <!-- Date d'Obtention -->
                    <div class="form-group">
                        <label for="date_obtention" class="block text-sm font-semibold text-gray-700 mb-2">
                            Date d'Obtention
                        </label>
                        <input 
                            type="date" 
                            name="date_obtention" 
                            id="date_obtention" 
                            value="{{ old('date_obtention', $exploitant->date_obtention ? $exploitant->date_obtention->format('Y-m-d') : '') }}"
                            class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 hover:border-gray-400"
                        >
                        @error('date_obtention')
                            <div class="text-red-500 text-sm mt-1 flex items-center gap-2">
                                <i class="fas fa-exclamation-circle"></i>
                                {{ $message }}
                            </div>
                        @enderror
                    </div>

                    <!-- Durée de Validité -->
                    <div class="form-group">
                        <label for="duree_validite" class="block text-sm font-semibold text-gray-700 mb-2">
                            Durée de Validité
                        </label>
                        <input 
                            type="text" 
                            name="duree_validite" 
                            id="duree_validite" 
                            value="{{ old('duree_validite', $exploitant->duree_validite) }}"
                            class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 hover:border-gray-400"
                            placeholder="Ex: 2 ans"
                        >
                        @error('duree_validite')
                            <div class="text-red-500 text-sm mt-1 flex items-center gap-2">
                                <i class="fas fa-exclamation-circle"></i>
                                {{ $message }}
                            </div>
                        @enderror
                    </div>

                    <!-- État de Validité -->
                    <div class="form-group">
                        <label for="etat_validite" class="block text-sm font-semibold text-gray-700 mb-2">
                            État de Validité
                        </label>
                        <input 
                            type="text" 
                            name="etat_validite" 
                            id="etat_validite" 
                            value="{{ old('etat_validite', $exploitant->etat_validite) }}"
                            class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 hover:border-gray-400"
                            placeholder="Ex: Valide, Expiré, En cours"
                        >
                        @error('etat_validite')
                            <div class="text-red-500 text-sm mt-1 flex items-center gap-2">
                                <i class="fas fa-exclamation-circle"></i>
                                {{ $message }}
                            </div>
                        @enderror
                    </div>

                    <!-- Situation Administrative -->
                    <div class="form-group">
                        <label for="situation_administrative" class="block text-sm font-semibold text-gray-700 mb-2">
                            Situation Administrative
                        </label>
                        <input 
                            type="text" 
                            name="situation_administrative" 
                            id="situation_administrative" 
                            value="{{ old('situation_administrative', $exploitant->situation_administrative) }}"
                            class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 hover:border-gray-400"
                            placeholder="Ex: En règle, Suspendu, En attente"
                        >
                        @error('situation_administrative')
                            <div class="text-red-500 text-sm mt-1 flex items-center gap-2">
                                <i class="fas fa-exclamation-circle"></i>
                                {{ $message }}
                            </div>
                        @enderror
                    </div>
                </div>
            </div>

            <!-- Section 4: Infractions et Exclusions -->
            <div class="bg-gradient-to-r from-orange-50 to-red-50 rounded-2xl p-6 border border-orange-200">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 bg-gradient-to-br from-orange-500 to-red-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-exclamation-triangle text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-orange-900">Infractions et Exclusions</h3>
                        <p class="text-orange-700 text-sm">Informations sur les infractions et exclusions</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Infractions Commises -->
                    <div class="form-group">
                        <label for="infractions_commises" class="block text-sm font-semibold text-gray-700 mb-2">
                            Infractions Commises
                        </label>
                        <textarea 
                            name="infractions_commises" 
                            id="infractions_commises" 
                            rows="3"
                            class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 hover:border-gray-400"
                            placeholder="Détails des infractions commises"
                        >{{ old('infractions_commises', $exploitant->infractions_commises) }}</textarea>
                        @error('infractions_commises')
                            <div class="text-red-500 text-sm mt-1 flex items-center gap-2">
                                <i class="fas fa-exclamation-circle"></i>
                                {{ $message }}
                            </div>
                        @enderror
                    </div>

                    <!-- Durée d'Exclusion -->
                    <div class="form-group">
                        <label for="duree_exclusion" class="block text-sm font-semibold text-gray-700 mb-2">
                            Durée d'Exclusion
                        </label>
                        <input 
                            type="text" 
                            name="duree_exclusion" 
                            id="duree_exclusion" 
                            value="{{ old('duree_exclusion', $exploitant->duree_exclusion) }}"
                            class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 hover:border-gray-400"
                            placeholder="Ex: 6 mois"
                        >
                        @error('duree_exclusion')
                            <div class="text-red-500 text-sm mt-1 flex items-center gap-2">
                                <i class="fas fa-exclamation-circle"></i>
                                {{ $message }}
                            </div>
                        @enderror
                    </div>
                </div>

                <!-- Exclusion Checkbox -->
                <div class="form-group">
                    <div class="flex items-center gap-3">
                        <input 
                            type="checkbox" 
                            name="exclusion" 
                            id="exclusion" 
                            value="1"
                            {{ old('exclusion', $exploitant->exclusion) ? 'checked' : '' }}
                            class="w-5 h-5 text-teal-600 border-gray-300 rounded focus:ring-teal-500"
                        >
                        <label for="exclusion" class="text-sm font-semibold text-gray-700">
                            Exclu du système
                        </label>
                    </div>
                    @error('exclusion')
                        <div class="text-red-500 text-sm mt-1 flex items-center gap-2">
                            <i class="fas fa-exclamation-circle"></i>
                            {{ $message }}
                        </div>
                    @enderror
                </div>
            </div>

            <!-- Form Actions -->
            <div class="flex items-center gap-4 pt-6 border-t border-gray-200">
                <button 
                    type="submit" 
                    class="inline-flex items-center gap-3 px-6 py-3 bg-gradient-to-r from-teal-600 to-cyan-600 text-white rounded-xl hover:from-teal-700 hover:to-cyan-700 transition-all duration-300 transform hover:scale-105 shadow-lg"
                    id="submitBtn"
                >
                    <i class="fas fa-save"></i>
                    <span class="font-semibold">Mettre à jour l'Exploitant</span>
                </button>
                
                <a 
                    href="{{ route('exploitants.index') }}" 
                    class="inline-flex items-center gap-3 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-all duration-300"
                >
                    <i class="fas fa-arrow-left"></i>
                    <span>Retour</span>
                </a>
            </div>
        </form>
    </div>

    <!-- Information Section -->
    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-3xl p-8 mt-8 border border-blue-200 shadow-xl">
        <div class="flex items-center gap-4 mb-6">
            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center">
                <i class="fas fa-info-circle text-white text-xl"></i>
            </div>
            <div>
                <h3 class="text-2xl font-bold text-blue-900">Informations de l'Exploitant</h3>
                <p class="text-blue-700">Détails et statistiques</p>
            </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white rounded-2xl p-6 border border-blue-200">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-calendar text-white"></i>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-900">Créé le</h4>
                        <p class="text-gray-600 text-sm">{{ $exploitant->created_at->format('d/m/Y H:i') }}</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-2xl p-6 border border-blue-200">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-clock text-white"></i>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-900">Modifié le</h4>
                        <p class="text-gray-600 text-sm">{{ $exploitant->updated_at->format('d/m/Y H:i') }}</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-2xl p-6 border border-blue-200">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-violet-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-database text-white"></i>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-900">ID</h4>
                        <p class="text-gray-600 text-sm">#{{ $exploitant->id }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@endsection

@push('styles')
<style>
    .form-input {
        background-image: none;
    }
    
    .form-input:focus {
        box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
    }
    
    /* Prevent duplicate error messages */
    .form-group .text-red-500:not(:first-child) {
        display: none;
    }
    
    /* Dark mode support */
    .dark-mode .form-input {
        background-color: var(--dark-bg-secondary);
        border-color: var(--dark-border);
        color: var(--dark-text-primary);
    }
    
    .dark-mode .form-input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(20, 184, 166, 0.2);
    }
</style>
@endpush

@push('scripts')
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('exploitantForm');
    const submitBtn = document.getElementById('submitBtn');
    
    // Form validation
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Basic validation
        const requiredFields = form.querySelectorAll('[required]');
        let isValid = true;
        
        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                field.classList.add('border-red-500');
                isValid = false;
            } else {
                field.classList.remove('border-red-500');
            }
        });
        
        if (isValid) {
            // Show loading state
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Mise à jour en cours...';
            submitBtn.disabled = true;
            
            // Submit form
            form.submit();
        } else {
            alert('Veuillez remplir tous les champs obligatoires.');
        }
    });
    
    // Real-time validation
    const inputs = form.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
        input.addEventListener('blur', function() {
            if (this.hasAttribute('required') && !this.value.trim()) {
                this.classList.add('border-red-500');
            } else {
                this.classList.remove('border-red-500');
            }
        });
    });
});
</script>
@endpush